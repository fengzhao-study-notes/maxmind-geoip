# 概述

有了 geoIP 数据库，就可以配置给nginx配置geoip来实现waf，仅允许特定地区的用户访问站点



> **nginx动态模块**，动态库与静态库区别：
> - 静态库会将所有的源代码编译进最终的二进制可执行文件中；
> - 动态库在Nginx二进制可执行文件中只保留了调用它的地址，在需要用到动态库的功能时，由Nginx的二进制可执行文件（Nginx Executable）去调用这个动态库，再去完成对应的功能。
> 
> 好处：当我们仅仅需要修改某一个模块、升级某个模块的功能时（特别是当Nginx编译了大量的第三方模块），重新编译这个动态库，而不用替换二进制可执行文件，编译出新的动态库后，只需要替换出旧的动态库，让 Nginx reload即可使用新的模块功能。


ngx_http_geoip_module 支持 nginx 动态模块，可以./configure make之后重新编译出so文件，从 ./nginx-1.21.4/objs/ngx_http_image_filter_module.so 移动到 /usr/local/nginx/modules/ 中，然后在nginx.conf中引用这个文件就可以了，不必重新替换nginx二进制文件。

``` shell
yum install gcc gcc-c++ make automake autoconf libtool pcre* zlib openssl openssl-devel  gd gd-devel

wget -P /usr/local/src/  http://nginx.org/download/nginx-1.21.4.tar.gz  

tar -zxvf nginx-1.21.4.tar.gz   

cd nginx-1.21.4


./configure  --user=nginx  --group=nginx  --prefix=/usr/local/nginx/  --with-http_stub_status_module --with-http_ssl_module --with-http_image_filter_module=dynamic
--with-http_geoip_module=dynamic


make 

# make之后，就可以生成 ./nginx-1.21.4/objs/ngx_http_image_filter_module.so 文件，不需要再make install替换nginx可执行文件，

```


ngx_http_geoip2_module模块使用预编译的MaxMind数据库创建变量，其值取决于客户端 IP 地址 ，通过此模块我们可以精准的限制或者允许某个国家的IP地址访问WEB站点。






